<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>🛒 طلبية ملابس</title>
<style>
  body {
    font-family: "Cairo", sans-serif;
    direction: rtl;
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg,#eef2f7,#dbeafe);
    color: #2c3e50;
  }

  /* 🔹 ألبوم الصور (سلايدر بسيط) */
  .slideshow {
    width: 98%;
    max-width: 700px;
    margin: 24px auto 6px;
    position: relative;
    overflow: hidden;
    border-radius: 14px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.18);
    background: #fff;
  }
  .slideshow .slide {
    width: 98%;
    display: none;
    border-radius: 14px;
  }
  .slideshow .slide.active {
    display: block;
    animation: fade 0.9s ease-in-out;
  }
  @keyframes fade {
    from { opacity: 0.4; transform: scale(1.01); }
    to   { opacity: 1; transform: scale(1); }
  }

  /* 📋 الفورم */
  form {
    max-width: 700px;
    margin: 18px auto 40px;
    padding: 22px;
    background: #ffffff;
    border-radius: 14px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.12);
  }
  h2 {
    text-align: center;
    color: #2563eb;
    margin-top: 6px;
    margin-bottom: 10px;
  }
  label {
    display: block;
    margin-top: 12px;
    font-weight: bold;
    color: #344;
  }
  input, select {
    width: 98%;
    padding: 10px;
    margin-top: 6px;
    font-size: 16px;
    border-radius: 10px;
    border: 1px solid #ccc;
    transition: 0.2s;
    box-sizing: border-box;
  }
  input:focus, select:focus {
    border-color: #2563eb;
    box-shadow: 0 0 6px rgba(37,99,235,0.18);
    outline: none;
  }
  button {
    margin-top: 18px;
    width: 98%;
    padding: 8px;
    background: #2563eb;
    color: #fff;
    border: none;
    border-radius: 12px;
    font-size: 18px;
    cursor: pointer;
  }
  button:hover { background: #1e40af; }

  .piece {
    border: 2px dashed #2563eb;
    padding: 12px;
    border-radius: 10px;
    margin-bottom: 12px;
    background: #f0f9ff;
  }

  .piece img { 
  max-width:240px;   /* تكبير الصورة */
  display:block; 
  margin:8px auto; 
  border-radius:10px; 
  box-shadow: 0 4px 10px rgba(0,0,0,0.2); /* ظل خفيف يعطي جمالية */
}
  #priceDetails {
    margin-top: 14px;
    font-weight: bold;
  }

  /* نافذة النجاح */
  #successModal {
    display:none;
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.56);
    z-index: 9999;
    align-items: center;
    justify-content: center;
  }
  #successModal .modal-content {
    background:#fff;
    padding:18px;
    border-radius:12px;
    width: min(420px, 92%);
    margin: 0 auto;
    text-align: center;
    box-shadow: 0 8px 28px rgba(0,0,0,0.25);
  }
  #successModal h3 { color: #118a3b; margin: 6px 0 8px; }
  #successModal p { margin: 8px 0; }
  #successModal button { margin-top:10px; padding:10px 20px; border-radius:8px; background:#2563eb; color:white; border:none; cursor:pointer; }

  /* تحميل اثناء الإرسال */
  #loading { display:none; text-align:center; margin-top:12px; }
  #loading img { vertical-align: middle; }

  /* Responsive */
  @media (max-width:520px){
    .slideshow { max-width: 94%; }
    form { padding: 16px; margin: 12px auto 28px; }
  }
</style>
</head>
<body>

  <!-- 🔹 السلايدر (ألبوم الصور) -->
  <div class="slideshow" aria-hidden="false">
    <!-- الصور سيتم تعبئتها بواسطة الجافاسكربت أو يمكنك وضع img ثابت هنا -->
    <img class="slide active" src="images/Modal1.jpg" alt="مودال 1" onerror="this.onerror=null;this.src=this.src.replace('/images/','/image/');">
    <img class="slide" src="images/Modal2.jpg" alt="مودال 2" onerror="this.onerror=null;this.src=this.src.replace('/images/','/image/');">
    <img class="slide" src="images/Modal3.jpg" alt="مودال 3" onerror="this.onerror=null;this.src=this.src.replace('/images/','/image/');">
    <img class="slide" src="images/Modal4.jpg" alt="مودال 4" onerror="this.onerror=null;this.src=this.src.replace('/images/','/image/');">
    <img class="slide" src="images/Modal5.jpg" alt="مودال 5" onerror="this.onerror=null;this.src=this.src.replace('/images/','/image/');">
  </div>

  <h2>🛒 طلبية ملابس أطفال</h2>

  <form id="orderForm">
    <label>👤 الاسم الكامل:</label>
    <input type="text" name="name" required>

    <label for="phone">📦 رقم الهاتف:</label>
    <input type="tel" id="phone" name="phone"
        dir="rtl"
        placeholder="أدخل رقم الهاتف"
        pattern="^[0-9]{10}$"
        maxlength="10"
        required
        oninvalid="this.setCustomValidity('الرجاء إدخال رقم هاتف صحيح مكون من 10 أرقام')"
        oninput="this.setCustomValidity('')">

    <label>📍 الولاية:</label>
    <select id="wilaya" name="wilaya" required></select>

    <label>📍 الدائرة:</label>
    <input type="text" name="daire" required>

    <label>🏠 العنوان الكامل:</label>
    <input type="text" name="address" required>

    <div id="piecesContainer"></div>
    <button type="button" onclick="addPiece()">➕ أطلب نوعية</button>

    <label>🚚 نوع التوصيل:</label>
    <select id="deliveryType" name="deliveryType">
      <option value="home">إلى المنزل</option>
      <option value="desk">إلى المكتب</option>
    </select>

    <div id="priceDetails">
      💰 السعر: 0 دج<br>
      💸 السعر الكلي: 0 دج
    </div>

    <button type="submit">✅ إرسال الطلب</button>

    <div id="loading">
      <img src="https://i.gifer.com/ZZ5H.gif" alt="جاري الإرسال..." width="56">
      <p>⏳ جاري معالجة طلبك...</p>
    </div>
  </form>

  <!-- نافذة النجاح -->
  <div id="successModal" role="dialog" aria-modal="true">
    <div class="modal-content">
      <h3>✅ تم إرسال الطلبية بنجاح</h3>
      <p>سيتصل بك فريق المبيعات لتأكيد الطلبية.</p>
      <p id="totalPrice"></p>
      <button onclick="closeModal()">إغلاق</button>
    </div>
  </div>

<script>
/* ========== إعدادات (غيرها إذا لزم) ========== */
// رابط سكربت Google Apps Script المنشور (غيّره إلى سكربتك إذا لزم)
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyWFjyYt1TxAS6ub--A0GQtKQa_azETGo8tw6c3SezWuoF8_p6gNH9gKQEVLN07QC0M/exec";

// لائحة صور السلايدر (أسماء الملفات داخل مجلد images أو image)
const imagesList = ["Modal1.jpg","Modal2.jpg","Modal3.jpg","Modal4.jpg","Modal5.jpg"];

// سعر الوحدة (يمكن تغييره)
const UNIT_PRICE = 2000;

/* ================== سلايدر بسيط ================== */
(function initSlider(){
  const slides = document.querySelectorAll(".slideshow .slide");
  let idx = 0;
  if(!slides || slides.length === 0) return;
  function show(i){
    slides.forEach((s, j) => s.classList.toggle("active", j===i));
  }
  function next(){
    idx = (idx + 1) % slides.length;
    show(idx);
  }
  // تغيير تلقائي كل 3 ثواني
  setInterval(next, 3000);
})();

/* ================== نموذج/قطع/سعر ================== */
let pieceCount = 0;

// أسعار التوصيل لكل ولاية (كما في كودك السابق)
const deliveryPrices = {
  "أدخل الولاية": { "home": 0, "desk": 0 },
  "أدرار": { "home": 1100, "desk": 600 },
  "الشلف": { "home": 700, "desk": 400 },
  "الأغواط": { "home": 900, "desk": 500 },
  "أم البواقي": { "home": 650, "desk": 400 },
  "باتنة": { "home": 700, "desk": 400 },
  "بجاية": { "home": 700, "desk": 400 },
  "بسكرة": { "home": 900, "desk": 500 },
  "بشار": { "home": 1100, "desk": 600 },
  "البليدة": { "home": 500, "desk": 250 },
  "البويرة": { "home": 700, "desk": 400 },
  "تمنراست": { "home": 1300, "desk": 800 },
  "تبسة": { "home": 700, "desk": 400 },
  "تلمسان": { "home": 800, "desk": 400 },
  "تيارت": { "home": 800, "desk": 400 },
  "تيزي وزو": { "home": 700, "desk": 400 },
  "الجزائر": { "home": 500, "desk": 250 },
  "الجلفة": { "home": 900, "desk": 500 },
  "جيجل": { "home": 700, "desk": 400 },
  "سطيف": { "home": 700, "desk": 400 },
  "سعيدة": { "home": 800, "desk": 400 },
  "سكيكدة": { "home": 600, "desk": 400 },
  "سيدي بلعباس": { "home": 700, "desk": 400 },
  "عنابة": { "home": 700, "desk": 400 },
  "قالمة": { "home": 600, "desk": 400 },
  "قسنطينة": { "home": 600, "desk": 400 },
  "المدية": { "home": 700, "desk": 400 },
  "مستغانم": { "home": 700, "desk": 400 },
  "المسيلة": { "home": 800, "desk": 400 },
  "معسكر": { "home": 700, "desk": 400 },
  "ورقلة": { "home": 900, "desk": 500 },
  "وهران": { "home": 800, "desk": 400 },
  "البيض": { "home": 800, "desk": 500 },
  "إليزي": { "home": 1300, "desk": 600 },
  "برج بوعريريج": { "home": 700, "desk": 400 },
  "بومرداس": { "home": 700, "desk": 400 },
  "الطارف": { "home": 700, "desk": 400 },
  "تندوف": { "home": 1300, "desk": 600 },
  "تيسمسيلت": { "home": 800, "desk": 400 },
  "الوادي": { "home": 900, "desk": 500 },
  "خنشلة": { "home": 700, "desk": 500 },
  "سوق أهراس": { "home": 700, "desk": 400 },
  "تيبازة": { "home": 700, "desk": 400 },
  "ميلة": { "home": 500, "desk": 350 },
  "عين الدفلى": { "home": 700, "desk": 400 },
  "النعامة": { "home": 800, "desk": 500 },
  "عين تموشنت": { "home": 800, "desk": 400 },
  "غرداية": { "home": 900, "desk": 500 },
  "غليزان": { "home": 700, "desk": 400 },
  "تيميمون": { "home": 1100, "desk": 600 },
  "برج باجي مختار": { "home": 0, "desk": 0 },
  "أولاد جلال": { "home": 900, "desk": 500 },
  "بني عباس": { "home": 1100, "desk": 0 },
  "إن صالح": { "home": 1300, "desk": 600 },
  "إن قزام": { "home": 0, "desk": 0 },
  "تقرت": { "home": 900, "desk": 0 },
  "جانت": { "home": 1100, "desk": 500 },
  "المغير": { "home": 0, "desk": 0 },
  "المنيعة": { "home": 900, "desk": 0 }
};

// اضافة الولايات للقائمة
const wilayaSelect = document.getElementById("wilaya");
Object.keys(deliveryPrices).forEach(w => {
  const opt = document.createElement("option");
  opt.value = w;
  opt.textContent = w;
  wilayaSelect.appendChild(opt);
});

// دالة تحديد المقاس حسب الوزن
function getSizeByWeight(weight) {
  if(weight>=4 && weight<=9) return "XS";
  if(weight>=10 && weight<=14) return "S";
  if(weight>=15 && weight<=19) return "M";
  if(weight>=20 && weight<=24) return "L";
  if(weight>=25 && weight<=29) return "XL";
  if(weight>=30 && weight<=35) return "XXL";
  return "غير متوفر";
}

// إضافة قطعة جديدة
function addPiece() {
  pieceCount++;
  const container = document.getElementById("piecesContainer");
  const div = document.createElement("div");
  div.className = "piece";

  const weightOptions = Array.from({length:32},(_,i)=>`<option value="${i+4}">${i+4} كغ</option>`).join('');

  div.innerHTML = `
    <label>🧩 اختر المودال:</label>
    <select name="modal${pieceCount}" onchange="showModalImage(this,${pieceCount}); updatePrice();" required>
      <option value="">-- اختر مودال --</option>
      <option value="1">مودال رقم 1</option>
      <option value="2">مودال رقم 2</option>
      <option value="3">مودال رقم 3</option>
      <option value="4">مودال رقم 4</option>
      <option value="5">مودال رقم 5</option>
    </select>
    <div id="modalImage${pieceCount}" style="margin-top:10px; text-align:center;"></div>

    <label>🔢 الكمية:</label>
    <select name="quantity${pieceCount}" onchange="updatePrice()" required>
      ${Array.from({length:10},(_,i)=>`<option value="${i+1}">${i+1}</option>`).join('')}
    </select>

    <label>🎨 اللون:</label>
    <select name="color${pieceCount}" required>
      <option value="أبيض">أبيض</option>
      <option value="أسود">أسود</option>
      <option value="رمادي">رمادي</option>
      <option value="أزرق">أزرق</option>
      <option value="أحمر">أحمر</option>
      <option value="أخضر">أخضر</option>
    </select>

    <label>⚖️ وزن الطفل (كغ):</label>
    <select name="weight${pieceCount}" onchange="updateSize(this,${pieceCount}); updatePrice();" required>
      ${weightOptions}
    </select>

    <label>📏 المقاس:</label>
    <input type="text" name="size${pieceCount}" id="size${pieceCount}" readonly>
  `;
  container.appendChild(div);
  // تحديث السعر بعد اضافة
  updatePrice();
}

// تحديث المقاس حسب الوزن
function updateSize(select,id){
  const weight = parseInt(select.value);
  document.getElementById(`size${id}`).value = getSizeByWeight(weight);
}

// عرض صورة المودال داخل القطعة عند اختيار المودال
function showModalImage(select, id) {
  const imgDiv = document.getElementById(`modalImage${id}`);
  const value = select.value;
  if (!value) {
    imgDiv.innerHTML = "";
    return;
  }

  const modalImages = {
    "1": "images/modal1.jpg",
    "2": "images/modal2.jpg",
    "3": "images/modal3.jpg",
    "4": "images/modal4.jpg",
    "5": "images/modal5.jpg"
  };

  // حاول تحميل من images/، وإذا فشل (onerror) يحول إلى image/
  const img = document.createElement("img");
  img.src = modalImages[value];
  img.alt = `مودال ${value}`;
  img.style.maxWidth = "220px";
  img.onerror = function(){
    // إذا لم توجد في images/ نجرب image/
    this.onerror = null;
    this.src = this.src.replace('/images/','/image/');
  };
  imgDiv.innerHTML = "";
  imgDiv.appendChild(img);
}

// حساب السعر وتحديث العرض
function updatePrice(){
  const pieces = document.querySelectorAll(".piece");
  let productPrice = 0;
  pieces.forEach(piece=>{
    const qtySelect = piece.querySelector('select[name^="quantity"]');
    const qty = qtySelect ? parseInt(qtySelect.value) : 0;
    productPrice += qty * UNIT_PRICE;
  });
  const wilaya = wilayaSelect.value;
  const deliveryType = document.getElementById("deliveryType").value;
  const deliveryCost = deliveryPrices[wilaya] ? (deliveryPrices[wilaya][deliveryType] || 0) : 0;
  const total = productPrice + deliveryCost;
  document.getElementById("priceDetails").innerHTML = `💰 السعر: ${productPrice} دج + ${deliveryCost} دج توصيل<br>💸 السعر الكلي: ${total} دج`;
  return total;
}

// تحديث السعر عند أي تغيير في الفورم
document.getElementById("orderForm").addEventListener("change", updatePrice);

/* عرض نافذة النجاح */
function showModal(total){
  document.getElementById("totalPrice").textContent = `💸 المجموع الكلي: ${total} دج`;
  document.getElementById("successModal").style.display = "flex";
}
function closeModal(){
  document.getElementById("successModal").style.display = "none";
}

/* إرسال البيانات إلى Google Apps Script */
document.getElementById("orderForm").addEventListener("submit", function(e){
  e.preventDefault();

  const form = document.getElementById("orderForm");
  const formData = new FormData(form);

  // نضيف المجموع الكلي داخل الفورم (اختياري)
  formData.set('total', updatePrice());

  // إظهار مؤشر التحميل
  document.getElementById("loading").style.display = "block";

  fetch(SCRIPT_URL, {
    method: "POST",
    body: formData
  })
  .then(res => res.text())
  .then(data => {
    document.getElementById("loading").style.display = "none";
    const total = updatePrice();
    showModal(total);
    form.reset();
    document.getElementById("piecesContainer").innerHTML = "";
    document.getElementById("priceDetails").innerHTML = "💰 السعر: 0 دج<br>💸 السعر الكلي: 0 دج";
    pieceCount = 0;
  })
  .catch(err => {
    document.getElementById("loading").style.display = "none";
    alert("❌ حدث خطأ أثناء الإرسال، حاول مرة أخرى.");
    console.error(err);
  });
});
</script>

</body>
</html>